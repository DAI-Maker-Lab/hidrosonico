# Hidrosónico
<i>Hidrosónico</i> is a stream gauge using a <a href="http://www.maxbotix.com/documents/HRXL-MaxSonar-WR_Datasheet.pdf">MaxSonar HRXL MB7369</a> sonar rangefinder, a <a href="http://www.seeedstudio.com/wiki/Seeeduino-Stalker_v3">Seeeduino Stalker v3</a> Arduino-compatible microcontroller platform, and an <a href="https://learn.adafruit.com/adafruit-fona-mini-gsm-gprs-cellular-phone-module/overview">Adafruit FONA 800</a> GSM module. It reads the distance between the sensor (specifically from where the housing meets the threading) and the water's surface directly below and sends this data at specified intervals to cloud-based storage, SMS, and/or email as determined by the user. It was designed to aid in collection of hydrological data and for flood early warning in developing countries. This version integrates a rain gauge at the request of the recipient. 

The code provided sends data to data.sparkfun.com as the cloud service but it could be easily adapted to any other provider. Please note the places in the code that are marked for user-specific input.

This is a beta unit and we will be making changes as a result of the data and experiences we are collecting from pilot installations in Honduras, as well as feedback from on-the-ground partners like CODEM-DC in Tegucigalpa.

All code and hardware files are being made available under open source licensing. If you use it, please let us know (robert_ryan-silva[at]dai.com), and if you improve it, please share!


##Bill of Materials

Links to vendors are provided for convenience and not meant to imply an endorsement of that vendor; most of the items are available from other sources, and most components can be adequately substituted with equivalents. We have no connections nor receive any benefit from any of the vendors indicated.

###Required:
<ul>
<li><b><a href="http://www.seeedstudio.com/depot/Seeeduino-Stalker-v3-p-1882.html?cPath=6_7">Seeeduino Stalker v3</a></b>. Most Arduino-compatible microcontrollers will work, but most will require additional circuitry to charge the battery from a solar cell and for use of the real-time clock. Some Arduino-compatibles will require some pin changes (though the Arduino Uno and its equivalents should be fine).</li>
<li><b><a href="https://www.adafruit.com/products/1946">Adafruit FONA 800</a> and <a href="https://www.adafruit.com/products/1859">antenna</a></b>. The FONA 808 would also work, but would require some wiring changes and would not fit on the circuit board as designed. Any GSM module that is not based on the SIMCOM SIM 800 series chips would need code changes to work properly.</li>
<li><b><a href="http://www.amazon.com/Maxbotix-MB7369-HRXL-MaxSonar-WRM/dp/B00A7YHBT2/ref=sr_1_1?ie=UTF8&qid=1434393383&sr=8-1&keywords=Maxbotix+MaxSonar+HRXL+MB7369&pebp=1434393385707&perid=1H5KG4AJ9JRJ434Q8SGC">Maxbotix MaxSonar HRXL MB7369</a></b>.</li>
<li><b>A solar panel</b>. We use <a href="https://www.adafruit.com/products/500">these</a>. We have not found any panels that terminate in the JST connector that the Stalker takes, so a <a href="https://www.adafruit.com/products/261">JST connector</a> is highly recommended; <a href="http://www.amazon.com/gp/product/B0076AY6J8?psc=1&redirect=true&ref_=oh_aui_search_detailpage">Scotchlok butt connectors</a> or similar (inside the enclosure, of course) make connecting the JST connector to the solar panel quite easy.</li>
<li><b>A lithium-ion battery</b>. We use <a href="https://www.adafruit.com/products/1781">these</a>.</li>
</ul>

###Optional:
<ul>
<li><b>Rain gauge</b>. You can collect rainfall data at the same site for a minimal additional cost with the addition of a rain gauge. The <i>Hidrosónico</i> code in the repository records data from a simple <a href="https://www.argentdata.com/catalog/product_info.php?products_id=168">Argent Data Systems rain gauge</a>. You'll need two 1K ohm resistors and a pair of 1N148 diodes to wire it to the microcontroller; an RJ-11 jack <a href="https://www.sparkfun.com/products/132">like this one from Sparkfun</a> will make this easier to work with, but you could strip the wires and solder them directly.</li>
<li><b>Circuit board</b>. Eagle files for a custom circuit board to accommodate the FONA and the optional rain gauge are included in the repository. You could cut this on a CNC machine or have it fabricated by a vendor like <a href="https://oshpark.com/">OSH Park</a>. It isn't strictly necessary -- you could wire the FONA directly -- but we found in practice that installation can be a violent process and connections coming loose is a real possibility. It is recommended especially if you intend to implement the rain gauge.</li>
<li><b>Interior structure</b>. The repository includes a STL file for an interior frame to hold the various internal components stable inside a 4 x 4 x 2 inch PVC junction box <a href=http://www.homedepot.com/p/Carlon-4-in-x-4-in-x-2-in-PVC-Junction-Box-5-Pack-E989NNJ-CAR/202206114">like this one</a>. We cut a 1-inch hole in the faceplate of the junction box and use PVC cement to attach a threaded 3/4-inch coupling <a href="http://www.homedepot.com/p/Carlon-3-4-in-PVC-Coupling-E940E-CTN/100404040">like this one</a>. Again, it's not necessary, but it does keep things from banging around much during installation. Additional holes must be drilled to accommodate the solar panel and the rain gauge. We use plumber's putty to fill the gaps around the cabling.</li>
<li><b>Mounts</b>. You'll want to mount the solar panel and optional rain gauge somehow. The repository includes SVG files for mounts that we have used with the PVC junction boxes. We cut these from sheet metal using waterjet cutters or 3.5mm polypropylene using laser cutters; both have the advantage of being easily bendable (with heat, in the case of polypropylene) to the desired angle. For those without access to fancy CNC cutters, the repository also includes a template for a simpler sheet metal solar panel mount that could be cut with aviation shears or other sheet metal cutting implements.</li>
<li><b><a href="http://www.seeedstudio.com/depot/Grove-4-pin-Female-Jumper-to-Grove-4-pin-Conversion-Cable-5-PCs-per-PAck-p-1020.html?cPath=98_106_57">Grove <-> female jumper cable</a></b>. Makes connecting the MaxBotix to the Stalker very easy indeed.</li>
<li><b>An Xbee 802.15.4 radio</b> will allow you to reprogram the unit from nearby without physically opening the housing, which can be a serious hassle depending on where the unit is mounted.</li>
